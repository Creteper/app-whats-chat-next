# AI 对话标签样式指南

本文档说明了 Whats Chat 应用中 AI 对话消息的各类标签及其渲染样式。

## 支持的标签类型

### 1. `<speech>` - 对话内容

**用途**: AI 的正常对话内容

**样式特点**:
- 浅色背景气泡 (`bg-muted`)
- 圆角边框，左下角小圆角
- 带阴影效果
- 显示时间戳（仅在最后一个 speech 后显示）
- **支持多个 speech 标签**

**示例**:
```xml
<speech>你好，很高兴见到你！</speech>
<speech>今天天气真不错，我们出去走走吧？</speech>
<speech>你觉得怎么样？</speech>
```

**渲染效果**:
```
┌─────────────────────────────┐
│ 你好，很高兴见到你！          │
└─────────────────────────────┘

┌─────────────────────────────┐
│ 今天天气真不错，我们出去走走吧│
└─────────────────────────────┘

┌─────────────────────────────┐
│ 你觉得怎么样？                │
└─────────────────────────────┘
  10:30:45 AM
```

---

### 2. `<inner thoughts>` - 内心想法

**用途**: AI 角色的内心独白

**样式特点**:
- 💭 emoji 前缀
- 淡红色斜体文字
- 半透明粉色背景
- 左侧玫瑰色边框
- 流式传输时带脉冲动画

**示例**:
```xml
<inner thoughts>他看起来很友好，我应该主动一些...</inner thoughts>
```

**渲染效果**:
```
│ 💭 他看起来很友好，我应该主动一些...
```

---

### 3. `<feature>` - 即将要做的事

**用途**: AI 角色接下来的行动意图，同时显示场景信息图标

**样式特点**:
- ✨ emoji 前缀
- 蓝色主题
- 半透明蓝色背景
- 左侧蓝色边框
- 较小字体
- **下方显示场景信息图标按钮**（悬停显示详情）

**示例**:
```xml
<feature>将要拿起水杯</feature>
```

**渲染效果**:
```
│ ✨ 将要拿起水杯
├─────────────────────────────────────────
│ [📍场景] [👔服饰] [🏃动作] [🛤️事件] [❤️发情度] [✨心动度]
│  ↓ 悬停任意按钮显示详细信息
```

**场景信息图标**:
- 📍 **MapPin** - 场景位置
- 👔 **Shirt** - 服饰状态细节
- 🏃 **Activity** - 姿态动作
- 🛤️ **Route** - 事件信息链
- ❤️ **Heart** (粉色) - 发情程度
- ✨ **Sparkles** (玫瑰色) - 心动程度

---

### 4. `<mem>` - 记忆总结

**用途**: AI 对当前对话的记忆总结

**样式特点**:
- 📝 emoji 图标
- 紫色主题
- 可折叠展开
- 半透明紫色背景
- 带边框

**示例**:
```xml
<mem>
卧室：双人床在门口面前，独立卫生间在门口右侧。
规则：9点之后小美洗澡，九点之前用户洗澡。
称呼：用户称呼小美为"宝贝"。
</mem>
```

**渲染效果**:
```
┌─────────────────────────────┐
│ ▶ 📝 记忆总结                │
├─────────────────────────────┤
│ 卧室：双人床在门口面前...     │
│ 规则：9点之后小美洗澡...      │
│ 称呼：用户称呼小美为"宝贝"    │
└─────────────────────────────┘
```

---

### 5. `<summary>` - 场景总结

**用途**: 当前场景的详细信息总结

**样式特点**:
- 📊 emoji 图标
- 琥珀色渐变背景
- 可折叠展开
- 结构化信息展示
- 包含场景、服饰、动作、事件、发情度等信息

**示例**:
```xml
<summary>
场景：教室；
服饰状态细节：白色衬衫、黑色短裙、白色蕾丝内衣；
姿态动作：站在讲台前，双手放在身后；
事件信息提炼：教室→老师讲课→学生听讲→下课铃响；
发情程度：5
</summary>
```

**渲染效果**:
```
┌────────────────────────────────────┐
│ ▶ 📊 场景信息                       │
├────────────────────────────────────┤
│ 场景：   教室                       │
│ 服饰：   白色衬衫、黑色短裙...      │
│ 动作：   站在讲台前，双手放在身后   │
│ 事件：   教室→老师讲课→...          │
│ 发情度： 5 ❤️                       │
│ 心动度： 8 ✨                       │
└────────────────────────────────────┘
```

---

### 6. 普通文本

**用途**: 不包含在任何标签中的文本

**样式特点**:
- 淡化的文字颜色
- 较小的字体
- 简单的圆角背景

**示例**:
```
(她轻轻地走了过来)
```

**渲染效果**:
```
(她轻轻地走了过来)
```

---

## 颜色主题说明

### 浅色模式
- **speech**: 灰色背景 (`bg-muted`)
- **inner thoughts**: 玫瑰红 (`rose-500/70` + `rose-50/30`)
- **feature**: 蓝色 (`blue-600/80` + `blue-50/30`)
- **mem**: 紫色 (`purple-600/80` + `purple-50/30`)
- **summary**: 琥珀-橙色渐变 (`amber-50/50` to `orange-50/50`)

### 深色模式
- **speech**: 深灰背景 (`bg-muted` in dark mode)
- **inner thoughts**: 淡玫瑰红 (`rose-400/60` + `rose-950/20`)
- **feature**: 淡蓝色 (`blue-400/70` + `blue-950/20`)
- **mem**: 淡紫色 (`purple-400/70` + `purple-950/20`)
- **summary**: 深琥珀-橙色渐变 (`amber-950/20` to `orange-950/20`)

---

## 特殊效果

### 流式传输动画
在流式传输过程中，所有标签都会添加 `animate-pulse` 效果，表示内容正在生成中。

### 可折叠标签
`<mem>` 和 `<summary>` 标签默认折叠，用户可以点击展开查看详细内容。

### 响应式设计
所有标签都支持：
- 文本自动换行 (`wrap-break-words`)
- 溢出隐藏 (`overflow-hidden`)
- 保留换行 (`whitespace-pre-wrap`)

---

## 使用建议

1. **对话内容**: 使用 `<speech>` 标签包裹所有对话，可以使用多个 speech 标签
2. **内心想法**: 用 `<inner thoughts>` 表达角色心理活动
3. **行动意图**: 用 `<feature>` 提前告知用户角色的下一步行动（会自动显示场景信息图标）
4. **记忆管理**: 用 `<mem>` 总结重要的场景、规则和称呼
5. **场景描述**: 用 `<summary>` 提供详细的场景状态信息（包括心动程度和发情程度）

## 对话历史记录系统

应用会自动追踪和管理以下信息：

### 记录区
- **心动程度**: 从 AI 回复的 `<summary>` 中提取
- **发情程度**: 从 AI 回复的 `<summary>` 中提取
- 这些值会在下次对话时注入到系统提示词中

### 回顾区
- 保存最近的 `<summary>` 标签内容
- 帮助 AI 记住场景状态

### 记忆精炼区
- 保存 `<mem>` 标签内容
- 包括场所格局、规则、称呼等信息
- AI 会根据这些信息保持角色一致性

### 用户提示词
- 每次用户消息会自动附加 UserPrompt
- 指导 AI 按照特定格式回复
- 不在界面中显示

---

## 开发者注意事项

- 所有标签解析逻辑位于 `lib/chat-content.ts`
- 渲染实现位于 `components/chat-page-client.tsx`
- 新增标签需要同时更新解析函数和渲染组件
- 样式使用 Tailwind CSS 类名，便于维护和定制

